<ion-header>
  <ion-toolbar>
    <div class="header-right">
      <span class="clock">{{ currentHourMinute }}</span>
      <svg class="progress-circle" viewBox="0 0 36 36">
        <path
          class="circle-bg"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <path
          class="circle"
          [attr.stroke-dasharray]="progress + ', 100'"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <text x="18" y="20.35" class="timer-text">{{ refreshTime }}</text>
      </svg>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div *ngIf="isLoading" class="loading-indicator">
    <p>Loading data, please wait...</p>
  </div>

  <div *ngIf="!isLoading" class="widget-container">
    <div class="widget">
      <h2 class="widget-heading">Standings</h2>
      <ion-searchbar
        [(ngModel)]="searchQuery"
        placeholder="Search by table heading"
        (ionInput)="onSearch($event)"
      ></ion-searchbar>
      <div class="table-container" [class.auto-scroll]="!isSearching">
        <ng-container *ngFor="let table of filteredTables">
          <table class="ranking-table">
            <thead>
              <tr>
                <th colspan="3">{{ table.heading }}</th>
              </tr>
              <tr>
                <th>Rank</th>
                <th>Player</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of table.data">
                <td>{{ row.rank }}</td>
                <td>{{ row.player }}</td>
                <td>{{ formatNumberWithSeparators(row.score) }}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
      </div>
    </div>
    <div class="widget">
      <h2 class="widget-heading">Season</h2>
      <table class="ranking-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Player</th>
            <th>Total Points</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let score of highScores">
            <td>{{ score.rank }}</td>
            <td>{{ players[score.player] || score.player }}</td>
            <td>{{ formatNumberWithSeparators(score.total_points) }}</td>
          </tr>
        </tbody>
      </table>    
    </div>
    <div class="widget">
      <h2 class="widget-heading">Latest Scores</h2>
      <table class="ranking-table">
        <thead>
          <tr>
            <th></th> <!-- New column for medals -->
            <th>Player</th>
            <th>Pinball</th>
            <th>Score</th>
            <th>Rank</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let score of latestScores">
            <td>
              <span *ngIf="score.rank === 1">ðŸ¥‡</span>
              <span *ngIf="score.rank === 2">ðŸ¥ˆ</span>
              <span *ngIf="score.rank === 3">ðŸ¥‰</span>
            </td>
            <td>{{ formatPlayerName(players[score.player] || score.player) }}</td>
            <td>{{ pinballs[score.pinball] || score.pinball }}</td>
            <td>{{ formatNumberWithSeparators(score.points) }}</td>
            <td>{{ score.rank !== null ? score.rank : '-' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="widget">
      <h2 class="widget-heading">Match-Suggestor (Beta)</h2>
      <p>This is the fourth widget.</p>
    </div>
  </div>
</ion-content>